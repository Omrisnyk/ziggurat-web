(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{rBKv:function(e,t,r){"use strict";r.r(t),r.d(t,"_frontmatter",(function(){return o})),r.d(t,"default",(function(){return h}));var i=r("wx14"),a=r("zLVn"),s=(r("q1tI"),r("7ljp")),n=r("hhGP"),o=(r("qKvR"),{});void 0!==o&&o&&o===Object(o)&&Object.isExtensible(o)&&!o.hasOwnProperty("__filemeta")&&Object.defineProperty(o,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"docs/Use-Cases:Nearby-Driver-Service.mdx"}});var c={_frontmatter:o},b=n.a;function h(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(s.b)(b,Object(i.a)({},c,r,{components:t,mdxType:"MDXLayout"}),Object(s.b)("h1",{id:"nearby-driver-service"},"Nearby Driver Service"),Object(s.b)("hr",null),Object(s.b)("p",null,"Whenever you use Go-jek to book a Ride or Car, the booking screen shows the drivers that are available to accept your request in the vicinity. This is made possible by Nearby Driver Service."),Object(s.b)("img",{src:"https://github.com/gojek/ziggurat/wiki/images/nearby_driver_service_screenshot.jpeg"}),Object(s.b)("br",null),"Gojek has around a million drivers that power the various products that we offer. Every couple of seconds, the driver app for each online driver sends the driver's GPS location to our systems that is then written to a topic in Kafka. We have filters in place that filter out the locations for the drivers that are available, i.e. are not busy in other orders, and this is the stream of data that we are concerned about in Nearby Driver Service (this is getting repetitive, lets call it NDS). So the topic that NDS subscribes to is `available-driver-pings`.",Object(s.b)("p",null,"Then NDS reads data off from the topic saves the driver pings with key as s2id. Then mobile app makes the API call to this service and then service returns the available driver in the "),Object(s.b)("p",null,"NDS subscribes to the ",Object(s.b)("inlineCode",{parentName:"p"},"available-driver-pings")," topic and sinks the messages into a redis-cache. The key to these locations has the driver's s2id which is then queried while fetching the nearby drivers in a particular location."),Object(s.b)("p",null,"This is how the ziggurat interface is implemented in NDS"),Object(s.b)("pre",null,Object(s.b)("code",Object(i.a)({parentName:"pre"},{className:"language-clojure"}),"(defn -main [& args]\n  (zig/main start-function stop-function {:available-driver-ping {:handler-fn redis/save-message}} routes/nds-routes))\n")),Object(s.b)("p",null,"The customer app makes an API call to NDS to fetch its nearby drivers. NDS fetches the available drivers (using on the S2ids) from the redis cache and returns the locations.\nZiggurat exposes its HTTP server which handles these requests. ",Object(s.b)("inlineCode",{parentName:"p"},"routes/actor-routes")," define the route and the handler function the requests."),Object(s.b)("pre",null,Object(s.b)("code",Object(i.a)({parentName:"pre"},{className:"language-clojure"}),'(def nds-routes\n  [["gojek/service_type/" {[:service_type "/drivers/nearby"]\n                           {:get nearby-by-service-type}}]])\n')),Object(s.b)("img",{src:"https://github.com/gojek/ziggurat/wiki/images/nearby_driver_service_diagram.png"}))}void 0!==h&&h&&h===Object(h)&&Object.isExtensible(h)&&!h.hasOwnProperty("__filemeta")&&Object.defineProperty(h,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"docs/Use-Cases:Nearby-Driver-Service.mdx"}}),h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---docs-use-cases-nearby-driver-service-mdx-8d75515caee21f256602.js.map